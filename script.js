/************************************************
 * File main.js
 ************************************************/

// Biến data mặc định, ví dụ ngắn. 
// Thực tế bạn dán đầy đủ data (1 đến 127) vào đây.
const defaultData = `
1,
A: 失礼ですが、お名前は。あなたの出身は何ですか。 
B: 私はタンです。ベトナム人です。

2,
A: 初めまして。こちらは私の先生です。
B: 初めまして。どうぞよろしくおねがいします。

3,
A: あのう、これは何ですか。
B: それは日本の辞書です。

4,
A: あなたはどこから来ましたか。それとも、ここにいますか。
B: 私はアメリカから来ました。

5,
A: これはあなたの帽子ですか。
B: いいえ、違います。私の帽子は黒いです。

6,
A: あの人は校長ですか。
B: そうじゃありません。教師です。

7,
A: これはスイスの土産です。どうぞ。
B: どうもありがとう。

8,
A: 午前９時から午後7時まで働きますか。
B: はい、仕事が大変ですが、とても好きです。

9,
A: 毎朝何時に起きますか。
B: 朝4時頃です。いつも早く起きて運動しています。

10,
A: 昼休みに会社の食堂で一緒にご飯を食べませんか。
B: いいですね。じゃ、また１２時に会いましょう。

11,
A: 先週、銀行へ行きましたか。
B: いいえ、まだ行っていません。

12,
A: あなたは電車で学校へ行きますか。
B: いいえ、よく自転車で行きます。でも、自転車が時々壊れます。だから、その時は電車で行きます。

13,
A: これは誰かの鞄ですか、それとも君のですか。
B: 私のじゃありません。多分クラスの誰かのです。

14,
A: 昨日、朝ご飯は会社で食べましたか、それとも家で食べましたか。
B: 昨日は早く起きたので、家で朝ご飯を食べました。その後、会社に行きました。
15,
A: この図書館で勉強をしますか。
B: ええ、よく月曜日と火曜日にここで勉強します。

16,
A: あなたはエンジニアですか。どこで仕事をしていますか。
B: 会社の事務室で働いています。この会社は近くにありますよ。

17,
A: 今週の土曜日は休みですね、どこか行く予定ですか。 
B: いいえ、まだ予定がありません。家でテレビを見ます。

18,
A: 先生は今日何歳ですか。
B: 内緒です。でも、まだ若いですよ。

19,
A: あなたの先生はどんな人ですか。 
B: とても優しくて親切な人です。

20,
A: 彼女は電気工ですか、それとも研究者ですか。
B: 彼女は大学の研究者です。

21,
A: 看護師の彼はどこにいますか。
B: 病院の受付にいると思います。

22,
A: お客様はどこにいますか。
B: 彼は中の事務所にいますよ。

23,
A: 彼の父は医者ですね。 
B: はい、今日は病院で働いていますよ。

24,
A: 料理人の彼女は、台所で何をしますか。
B: パンと卵で朝ご飯を料理しています。

25,
A: 電気がありますか。ドライヤーを使いたいです。
B: はい、大丈夫です。電気があります。

26,
A: タンさんの事務室は何階ですか。
B: 一階です。どうぞ。

27,
A: マイさんの名刺を探しています。彼女は銀行員です。 
B: これですか。

28,
A: 先生、この教室は寒いですね。
B: じゃ、窓を閉めましょう。

29,
A: ここは暑いですね。扇風機を使ってもいいですか。
B: はい、お願いします。

30,
A: 今日は忙しいですか。 
B: いいえ、あまり忙しくないですよ。

31,
A: すみません、何をお探していますか。
B: 靴を買いたいですが、売り場はどこですか。

32,
A: 彼女は銀行で働いていますか。 
B: はい、彼女は銀行員です。勤勉で上手です。

33,
A: これはあなたの荷物ですか、それとも私の荷物ですか。
B: いいえ、あの人のですよ。

34,
A: 教授はどちらにいますか。
B: 大学の会議室にいますよ。

35,
A: ライオンと虎と、どちらが強いですか。
B: ライオンのほうが虎より強いです。

36,
A: 日本の生活に慣れましたか。
B: そうですね。もう大丈夫です。

37,
A: 毎朝は新聞を読みますか。
B: はい、いつも読んでいます。

38,
A: 今週、ベトナムのサッカーの試合を見ますか。 
B: もちろんです。

39,
A: これは動物の絵ですか。
B: はい、リスと狐の絵です。

40,
A: 今日は何日ですか。 
B: 4月5日です。

41,
A: どこでお花見をするつもりですか。 
B: 町の公園です。そこは桜がとても綺麗です。

42,
A: トイレはこの建物の何階ですか。 
B: 2階です、廊下の突き当りにあります。

43,
A: 明日、美術館に行くつもりですか。
B: もちろんです。一緒に行きませんか。

44,
A: 彼はインド出身ですか。
B: はい、インドから来ました。

45,
A: 財布を無くしました。
B: 警察署に行って聞いてみてください。

46,
A: 旅行はいつ行きますか。
B: 来月行きます。船で行くつもりです。

47,
A: 紅茶とお茶と、どちらが好きですか。
B: 紅茶の方が苦くて、お茶の方が甘いです。少し苦いお茶が好きなので、紅茶の方が好きです。

48,
A: 会社の入口はどこですか。
B: あそこです。駐車場の近くにあります。

49,
A: クリスマスは何日ですか。
B: １２月２５日ですよ。

50,
A: まだ晩ご飯を食べませんか。
B: ええ、ちょっと忙しくて…。

51,
A: 来週の火曜日は何をしますか。
B: 会社で会議をする予定です。

52,
A: 新幹線と飛行機、どちらが速いですか。
B: 飛行機のほうが速いと思います。

53,
A: 私は今晩7時頃に弁護士に会います。
B: 彼に電話を掛けて知らせてください。

54,
A: もう宿題をしましたか。
B: いいえ、まだしていません。
55,
A: このノートに何を書きますか。
B: 仕事の内容を書きます。

56,
A: お酒を飲みますか。
B: いいえ、あまり飲みません。たくさん飲むと健康に悪いです。

57,
A: テニスをするは楽しいですね。
B: はい、でも時々疲れます。

58,
A: 机に花を飾りました。どうですか。
B: とても素敵ですね。部屋が賑やかになりました。

59,
A: 今晩の晩ご飯は何を食べますか。
B: 肉と野菜を作るつもりです。

60,
A: お客様、どこへ行きますか。
B: 駅までお願いします。

61,
A: 廊下を歩いてください。
B: はい、わかりました。

62,
A: すみません、あの店は何を売っていますか。
B: 果物と野菜を売っています。

63,
A: 彼はいつ帰りますか。
B: 彼はまだ帰りません。仕事をしないといけません。

64,
A: 朝、牛乳を飲みますか。
B: いいえ、ミルクは飲みません。紅茶だけ飲みます。

65,
A: 今日は新しいシャツを買ったんですか。いくらですか。
B: ２０００円です。デパートで買いました。

66,
A: 中国からの荷物はどこですか。
B: 事務室の中に置きました。

67,
A: この靴は誰に上げますか。
B: 友達に上げます。プレゼントです。

68,
A: すみません、カメラを借りますか。
B: はい、どうぞ。丁寧に使ってくださいね。

69,
A: これは辛いラーメンですか。
B: はい、辛いですよ。

70,
A: 彼女は毎晩、晩ご飯を作るんですか。
B: いいえ、あまり作りません。レストランで食べます。

71,
A: 毎日会社へ行く前に何か飲みますか。
B: はい、コーヒーをいつも飲みます。

72,
A: 公園でよく歩きますか。 
B: はい、時々歩きます。そこで町の森を見ることができますよ。

73,
A: 狐と猫と、どちらが好きですか。
B: 猫のほうが好きです。面白いですから。

74,
A: 彼女は厳しい先生ですか。 
B: はい、でもとても優しい人です。

75,
A: もう病院へ行きましたか。
B: いいえ、まだ行っていません。明日行く予定です。

76,
A: あれは誰の車ですか。
B: あの方の車ですよ。とても格好いいですね。

77,
A: 先生、何を探していますか。
B: 鉛筆を探しています。仕事をするために必要です。

78,
A: 荷物を持ちますか。 
B: 受付に預けます。

79,
A: いつ晩ご飯が終わりますか。
B: ７時半に終わります。

80,
A: 今日は空が黒いですね。
B: そうですね。傘を持って行きます。

81,
A: もう昼ですね。会社へ帰りますか。
B: はい、午後は会議があります。

82,
A: この花はどんな花ですか。
B: 赤い桜です。とてもきれいですね。

83,
A: 土曜日は映画を見ますか。
B: はい、友達と映画を見に行きます。

84,
A: 来週の月曜日に会議室で会いませんか。
B: いいですね。何時に来ますか。

85,
A: この会社の社員は何人ですか。
B: 100人ぐらいです。

86,
A: 先生の部屋はどちらですか。
B: 廊下の突き当りを右に曲がると、先生の事務室があります。

87,
A: すみません。これ、お土産です。
B: ありがとうございます。嬉しいです。

88,
A: お元気ですか。日本の食べ物はどうですか。
B: 美味しいですが、ちょっと辛いです。

89,
A: あなたは車で来ましたか、それとも電車で来ましたか。
B: 電車で来ました。バスより速いですから。

90,
A: もう宿題をしましたか。
B: いいえ、まだしていません。これからします。大変ですね。

91,
A: すみません、このカメラを見せてください。
B: はい、どうぞ。撮ってみてもいいですよ。

92,
A: 金曜日、映画を見に行きませんか。
B: いいですね。どの映画を見ますか。

93,
A: 事務室ではパソコンを使っていますか。
B: はい、会社の仕事用にパソコンを使っていますよ。

94,
A: まだレポートを直していませんか。
B: もう直しました。昨日、先生に聞きました。

95,
A: この教室でテニスのビデオを見ませんか。
B: いいですね。そのビデオの内容がとても面白いそうです。

96,
A: エンジニアになるために、大学で勉強する予定です。
B: すごいですね。私もエンジニアになりたい。

97,
A: 警察署はどこですか。私の財布を無くしました。
B: あそこに店が見えますか。そこで曲がってください、道の突き当りにあります。

98,
A: ケーキを作りたいです。牛乳はありますが、卵とクリームがありません。
B: じゃ、スーパーで買いましょうか。

99,
A: テレビで映画を見る予定ですが、宿題が多くて終わらせないといけません。
B: 大変ですね。早く終わるように頑張ってくださいね。

100,
A: ここでタバコを吸ってもいいですか。
B: いいえ、ここで吸ってはいけません。

101,
A: あなたはいつベトナムに帰りますか。
B: 来週、１８日に飛行機で帰る予定です。

102,
A: 何を探していますか。
B: 薬を探しています。頭がちょっと痛いんです。

103,
A: あなたはテニスとサッカー、どちらが好きですか。
B: どちらも楽しいですが。でも、サッカーのほうがもっと好きです。

104,
A: 大学で何を勉強していますか。
B: 私の専攻は医学です。医者になるために、毎日図書館で本を読んでいます。

105,
A: 朝ご飯の前にいつも歯を磨きます。
B: そうですか。私もそうです。

106,
A: ライオンを見たことがありませんか。
B: はい、動物園で見ました。とても大きいですね。

107,
A: 子供用のフォークはどこにありますか。
B: それは家庭用品の売り場にあります。そこで見てください。

108,
A: 会議で新しいシャツを着ませんか。
B: もちろんです。それを着ます。

109,
A: 掃除機を借りてもいいですか。私の部屋が少し汚いです。
B: もちろんです。それは使ってもいいですよ。

110,
A: 小さい布団を買いたいですが、それはどこですか。
B: デパートの5階にあります。そこで見てください。

111,
A: 明日出発します。必要な持ち物を準備しています。
B: 明日は何時に出発しますか。

112,
A: 私は犬を飼っていますが、あなたは飼いますか。
B: いいえ、飼いません。あまり好きじゃありません。

113,
A: フォークとナイフで食べるのは難しいですか。
B: 慣れれば難しくありませんよ。難しかったら、お箸を使ってもいいですよ。

114,
A: この子に可愛いシャツを着てほしいです。
B: はい、どんな色が好きですか。

115,
A: 昨日の映画をもう見ましたか。 
B: いいえ、まだです。今晩、見ましょうか。

116,
A: 犬を噛まれたことがありますか。
B: いいえ、ありません。でも、噛まれたら、大変ですね。

117,
A: 庭で蛙を見ましたか。それは私が飼っています。
B: はい、見ました。それは大きいですね。

118,
A: キリンと牛、どちらが大きいですか。 
B: キリンのほうが大きいですね。

119,
A: 今日は休みますか。どうしましたか。
B: 病気なので、仕事することができません。

120,
A: 新幹線は早いですが、かなり高いですね。
B: そうですね。値段は少し高いですが、バスより便利ですよ。

121,
A: このハサミは切れますか。
B: はい、それでよく紙を切っています。

122,
A: バス停まで歩きますか。
B: いいえ、自転車で行きます。

123,
A: すみません、どこで申し込みますか。
B: 受付で申し込んでください。

124,
A: 私の枕はどこにあるか知っていますか。
B: 3階のワードローブの中にあると思います。

125,
A: 緑帽子を選ぶか、赤い帽子を選ぶか迷っています。
B: どちらも格好いいですが、私は赤いほうが好きです。

126,
A: 会社の会議のために資料を準備しています。参加しませんか。
B: はい、私も参加するつもりです。

127,
A: 壁に時計を飾りたいですが、いいでしょうか。
B: いいですよ。部屋が賑やかになりますね。
`;

// Lắng nghe sự kiện DOMContentLoaded để gắn logic cho index.html / display.html
window.addEventListener("DOMContentLoaded", () => {

  /************************************************
   * Phần cho index.html
   ************************************************/
  const createBtn = document.getElementById("createBtn");
  const clearBtn = document.getElementById("clearBtn"); // Nút "Xoá Data" (nếu cần)

  if (createBtn) {
    createBtn.addEventListener("click", () => {
      const input = document.getElementById("inputData").value.trim();

      let dialogues;
      if (input === "") {
        // Nếu trống => lấy data mặc định
        dialogues = parseData(defaultData);
      } else {
        // Ngược lại => parse data mới
        dialogues = parseData(input);
      }

      // Xáo trộn (shuffle) trước khi lưu
      shuffleArray(dialogues);

      // Lưu vào localStorage
      localStorage.setItem("dialogues", JSON.stringify(dialogues));

      // Chuyển trang
      window.location.href = "display.html";
    });

    // Nút Xoá Data (tùy chọn)
    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        localStorage.removeItem("dialogues");
        alert("Đã xóa dữ liệu trong localStorage.");
      });
    }
  }


  /************************************************
   * Phần cho display.html
   ************************************************/
  const dialogueContainer = document.getElementById("dialogue");
  if (dialogueContainer) {
    let dialogues = JSON.parse(localStorage.getItem("dialogues")) || [];
    let currentIndex = 0;

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const positionIndicator = document.getElementById("position");

    // Hàm hiển thị đoạn hội thoại
    function showDialogue(index) {
      if (index < 0) index = 0;
      if (index >= dialogues.length) index = dialogues.length - 1;
      currentIndex = index;

      dialogueContainer.textContent = dialogues[currentIndex] || "N/A";
      positionIndicator.textContent = (currentIndex + 1) + "/" + dialogues.length;

      // Disable nút nếu ở đầu/cuối
      prevBtn.disabled = (currentIndex === 0);
      nextBtn.disabled = (currentIndex === dialogues.length - 1);
    }

    // Hiển thị đoạn đầu
    if (dialogues.length > 0) {
      showDialogue(0);
    } else {
      dialogueContainer.textContent = "Không có dữ liệu!";
      positionIndicator.textContent = "0/0";
      if (prevBtn) prevBtn.disabled = true;
      if (nextBtn) nextBtn.disabled = true;
    }

    // Event Lùi
    if (prevBtn) {
      prevBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
          showDialogue(currentIndex - 1);
        }
      });
    }

    // Event Tiến
    if (nextBtn) {
      nextBtn.addEventListener("click", () => {
        if (currentIndex < dialogues.length - 1) {
          showDialogue(currentIndex + 1);
        }
      });
    }
  }
});


/************************************************
 * Hàm tách dữ liệu text thành mảng
 ************************************************/
function parseData(text) {
  // Tách theo dòng trống \n\s*\n (regex)
  const rawSegments = text.split(/\n\s*\n/);
  return rawSegments
    .map(item => item.trim())
    .filter(item => item.length > 0);
}


/************************************************
 * Hàm xáo trộn (Fisher–Yates)
 ************************************************/
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
